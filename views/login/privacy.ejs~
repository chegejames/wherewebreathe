<% layout('../layout') -%>
<% script('../bootstrap-switch-master/bootstrap-switch.min.js') -%>
<% stylesheet('../stylesheets/register.css') -%>
<% stylesheet('../bootstrap-switch-master/bootstrap-switch.css') -%>
<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">Stay Anonymous</h3>
  </div>
  <div class="panel-body">
    <p>There's no reason to share your real name, address, or contact information. Share your data under a false name and be careful of the potentially identifying information you decide to share.</p>
    <p>We work hard to keep your data secure, and don't need to know who you are.</p>
    <p>You can decide to share privately with our team of epidemiologists and social scientists, and the information you supply will only be used for scholarly purposes and in a non-identifying manner.</p>
    <p>If you choose to make your data public, anyone will be able to read your story to learn about indoor air contamination in mobile homes.</p>
  </div>
</div>
<h1>Publicly share your data?</h1> 
<form role="form" id='frmPriv'>
  <div class="form-group">
    <input type="checkbox" name="public"  value="public">
    <span id="lblPub"></strong>
    </span>
  </div>
  <div class="form-group">
    <input type="checkbox" name="researchers" value="research team">
    <span id="lblResearch"></strong></span>
  </div>
  <button type="submit" class="btn btn-primary">Update Privacy Settings</button>&nbsp;<a href="/">
</form>
<script>
function checkLblPub(state){
if(state){  
    $('#lblPub').html('Your data["individual answers"?] can be seen by <strong>anyone on the internet</strong>. (Only your chosen username will be shown along with your answers).');
  }
  else{
    $('#lblPub').html('Your data["individual answers"?]<strong> will not be visible publicly</strong>');
  } 
}
//checks state of switch, and sets text accordingly
function checkLblResearch(state){
  if(state){  
    $('#lblResearch').html('Your data["individual answers"?] are currently shared<strong> only with the WhereWeBreathe research team</strong>');
  }
  else{
    $('#lblResearch').html('Your data["individual answers"?] <strong>will not</strong> be shared with the WhereWeBreathe research team');
  } 
}
$(function(){
  $.fn.bootstrapSwitch.defaults.onColor = 'success';
  $.fn.bootstrapSwitch.defaults.offColor = 'danger';
  $.fn.bootstrapSwitch.defaults.onText = 'Yes';
  $.fn.bootstrapSwitch.defaults.offText = 'No';
 // $.fn.bootstrapSwitch.defaults.state = true;
  $("[name='researchers'], [name='public']").bootstrapSwitch('state', false)
  //set according to switch state
  checkLblPub($("[name='public']").bootstrapSwitch('state'));
  checkLblResearch($("[name='researchers']").bootstrapSwitch('state'));
})
//on state change, change lbl text
$("[name='public']").on('switchChange.bootstrapSwitch', function(event, state) {
  checkLblPub(state);
});
$("[name='researchers']").on('switchChange.bootstrapSwitch', function(event, state) {
  checkLblResearch(state);
});
$('#frmPriv').submit(function(event){
    //prevent actual submit, but HTML5 validation triggers
    event.preventDefault();
    $.post( '/privacy',{visInternet: $("[name='public']").bootstrapSwitch('state'), visResearch: $("[name='researchers']").bootstrapSwitch('state')})
      .fail(function(response) {
        $( ".alert" ).remove();
        console.log(response);
        var html = '<div class="alert alert-danger" role="alert">'+response.responseText+'</div>'
        $( html ).insertAfter( ".page-header" );
      })
      .done(function(response) {
        //redirect to login with message
        $( ".alert" ).remove();
        var html = '<div class="alert alert-success" role="alert">Your privacy settings have been saved.</div>'
        $( html ).insertAfter( ".page-header" );

      });

  });
</script>
